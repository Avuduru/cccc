:root {
    --bg-body: #dedede;
    --bg-card: #5c5c5c;
    /* Main gray background */
    --accent-green: #7cb342;
    --accent-red: #c0392b;
    --accent-orange: #e67e22;
    --accent-yellow: #f1c40f;
    --font-en: 'Silkscreen', cursive;
    --font-ar: 'Handjet', sans-serif;

    /* Canvas proportions controlled via JS config */
    --canvas-title-size: 5.5cqw;
    --canvas-genre-size: 2.8cqw;
    --canvas-synopsis-size: 3.2cqw;
    --canvas-v-title-size: 10cqw;
}

* {
    box-sizing: border-box;
}

body {
    margin: 0;
    padding: 20px;
    background-color: var(--bg-body);
    font-family: var(--font-ar);
    display: flex;
    justify-content: center;
    min-height: 100vh;
    direction: rtl;
}

/* --- MAIN GRID --- */
.card-container {
    width: 100%;
    background-color: var(--bg-card);
    border-radius: 20px;
    padding: 30px;
    /* Explicit Grid */
    display: grid;
    grid-template-columns: 1fr 2fr;
    /* Right: 33%, Left: 66% */
    grid-template-rows: auto 1fr auto;
    /* HeaderRow, MainRow, Footer */
    gap: 20px;
    position: relative;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    border: 6px solid #111;
}

/* --- 1. HEADER (Top Left) --- */
.card-header {
    grid-column: 2 / 3;
    grid-row: 1 / 2;
    background-color: #111;
    color: white;
    border-radius: 20px;
    padding: 20px;
    text-align: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
    border: 6px solid #000;
}

.logo {
    font-family: var(--font-en);
    font-size: 4rem;
    margin: 0;
    line-height: 1;
    letter-spacing: 2px;
}

.subtitle-en {
    font-family: var(--font-en);
    font-size: 0.7rem;
    color: #999;
    margin: 5px 0 0 0;
}

.subtitle-ar {
    font-size: 1.3rem;
    margin: 5px 0 0 0;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

/* --- 2. UNIFIED CONTROLS PANEL (Right Column) --- */
.top-controls {
    grid-column: 1 / 2;
    grid-row: 1 / 3;
    /* Span both rows */
    background-color: #111;
    color: white;
    border-radius: 20px;
    padding: 25px;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    /* Align content to top */
    gap: 15px;
    border: 6px solid #000;
    overflow: visible;
    /* Allow scrolling if content is too tall */
}

.control-row {
    display: flex;
    justify-content: flex-start;
    /* RTL: Start is Right side */
    align-items: center;
    gap: 15px;
    flex-wrap: wrap;
    /* Fix overlap on smaller screens */
}

.control-label {
    min-width: 80px;
    color: white;
    font-family: var(--font-ar);
    font-size: 1.5rem;
    font-weight: bold;
    text-align: right;
    white-space: nowrap;
}

.search-wrapper .control-label {
    color: #333333;
    /* Dark color for search label only */
    min-width: auto;
    /* Fit content */
    margin-left: 10px;
}

/* Type Pills */
/* Custom Dropdown */
.custom-dropdown {
    position: relative;
    font-family: var(--font-ar);
}

.dropdown-toggle {
    background: #333;
    border: 3px solid #000;
    color: #ccc;
    padding: 10px 20px;
    font-family: inherit;
    cursor: pointer;
    font-size: 1.1rem;
    font-weight: bold;
    box-shadow: 3px 3px 0px #000;
    min-width: 150px;
    text-align: center;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.dropdown-toggle::after {
    content: '▼';
    font-size: 0.8em;
    margin-right: 10px;
}

.dropdown-toggle:hover {
    background: #444;
}

.dropdown-menu {
    position: absolute;
    top: 100%;
    right: 0;
    left: 0;
    background: #222;
    border: 3px solid #000;
    box-shadow: 4px 4px 0px rgba(0, 0, 0, 0.5);
    z-index: 100;
    display: none;
    /* Hidden by default */
    border-radius: 0 0 10px 10px;
    overflow: hidden;
}

.dropdown-menu.show {
    display: block;
}

.dropdown-item {
    padding: 10px 15px;
    color: #fff;
    cursor: pointer;
    border-bottom: 1px solid #333;
    text-align: right;
    transition: background 0.2s;
}

.dropdown-item:hover {
    background: #333;
}

.dropdown-item.active {
    background: #2980b9;
    color: white;
}

.dropdown-item:last-child {
    border-bottom: none;
}

.orient-btn {
    background: #333;
    border: 3px solid #000;
    color: #ccc;
    padding: 10px 20px;
    font-family: inherit;
    cursor: pointer;
    font-size: 1.1rem;
    font-weight: bold;
    box-shadow: 3px 3px 0px #000;
}

.orient-btn.active {
    background: #2980b9;
    color: #fff;
}



.type-btn:active,
.orient-btn:active {
    transform: translate(2px, 2px);
    box-shadow: 1px 1px 0px #000;
}

.type-btn.active {
    background: var(--accent-green);
    color: #000;
    border-color: #000;
}

/* Search Bar */
.search-wrapper {
    flex: 1;
    position: relative;
    background: #ccc;
    border: 3px solid #000;
    height: 40px;
    display: flex;
    align-items: center;
    padding: 0 10px;
    box-shadow: 3px 3px 0px #000;
}

#search-query,
#reviewer-name-input {
    width: 100%;
    background: transparent;
    border: none;
    outline: none;
    font-family: inherit;
    font-size: 1rem;
}

#search-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: #222;
    border: 1px solid #444;
    border-radius: 10px;
    color: white;
    z-index: 99999;
    max-height: 250px;
    overflow-y: auto;
    overflow-x: hidden;
}

.search-result-item {
    padding: 10px;
    border-bottom: 1px solid #333;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    background-color: #222;
    overflow: hidden;
    position: relative;
    z-index: 100000;
}

.search-result-item:hover {
    background: #333;
}

.search-result-item img {
    width: 30px;
    height: 45px;
    object-fit: cover;
}

/* --- 3. PREVIEW PANEL (Bottom Left) --- */
/* --- 3. PREVIEW PANEL (Canvas) --- */
.info-panel {
    grid-column: 2 / 3;
    grid-row: 2 / 3;
    background-color: #000;
    border: 6px solid #111;
    position: relative;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0;
    container-type: size;
    /* Enable both width and height container queries */
}

/* Aspect Ratio Locking */
.info-panel.horizontal {
    aspect-ratio: 16 / 9;
    width: 100%;
}

.info-panel.vertical {
    aspect-ratio: 2 / 3;
    /* Typical book/manga cover ratio */
    width: auto;
    height: 800px;
    margin: 0 auto;
}

.canvas-bg {
    position: absolute;
    inset: 0;
    z-index: 0;
    background: #000;
}

.bg-image {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    opacity: 0.9;
    /* Increased image opacity for better visibility */
    z-index: 1;
}

.bg-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    /* 70% overlay darkness */
    z-index: 2;
}

.canvas-content {
    position: relative;
    z-index: 5;
    width: 100%;
    height: 100%;
    padding: 3cqw;
    /* Relative padding */
    display: flex;
    gap: 3cqw;
    box-sizing: border-box;
    pointer-events: none;
    /* FIX: Allow clicks to pass through to poster */
}

/* Re-enable clicks for content children */
.canvas-content>* {
    pointer-events: auto;
}

/* HORIZONTAL LAYOUT */
.horizontal .canvas-content {
    flex-direction: row;
}

.horizontal .poster-container {
    height: 100%;
    aspect-ratio: 1 / 1.414;
    /* A4 Ratio */
    flex-shrink: 0;
    border: 3px solid rgba(255, 255, 255, 0.3);
    /* Match vertical style */
    box-shadow: 10px 10px 0px rgba(0, 0, 0, 0.5);
    overflow: hidden;
}

.poster-div {
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    display: block;
    position: relative;
    cursor: default;
}

.poster-div.manual-mode {
    cursor: pointer;
}

.upload-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 1.2rem;
    font-weight: bold;
    opacity: 0;
    transition: opacity 0.2s;
    pointer-events: none;
}

.poster-div.manual-mode.empty-poster .upload-overlay {
    opacity: 1;
}

/* Optional: Show on hover only if empty? Or never show if full?
   User asked to "remove upload button... to not obstruct".
   So if it has an image, we don't show overlay even on hover.
   But we keep cursor pointer.
*/
.poster-div.manual-mode:not(.empty-poster):hover .upload-overlay {
    opacity: 0;
    /* Ensure it stays hidden */
}

/* Vertical mode: show full poster without cropping */
.vertical .poster-div {
    background-size: cover;
    background-position: center top;
    aspect-ratio: 2/3;
    width: 100%;
    height: auto;
}

.info-content-right {
    flex: 1;
    display: flex;
    flex-direction: column;
    text-align: right;
    color: white;
    container-type: inline-size;
}

.header-info {
    text-align: right;
    /* Ensure consistent left alignment for English content -> REMOVED */
    margin: 0;
    padding: 0;
}

/* GRADUAL DARKNESS FROM TOP AND BOTTOM */
.vertical .poster-container::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(to bottom,
            rgba(0, 0, 0, 0.6) 0%,
            /* Reduced from 0.85 */
            rgba(0, 0, 0, 0.2) 15%,
            rgba(0, 0, 0, 0) 30%,
            rgba(0, 0, 0, 0) 70%,
            rgba(0, 0, 0, 0.2) 85%,
            rgba(0, 0, 0, 0.6) 100%);
    /* Reduced from 0.85 */
    z-index: 2;
    pointer-events: none;
    /* FIX: Allow clicks to pass through to poster */
}

/* ... */

.header-info h2 {
    font-family: var(--font-ar);
    font-weight: 800;
    /* Heavier weight for Handjet title */
    /* Strict relative sizing based on width */
    font-size: var(--canvas-title-size);
    margin: 0;
    padding: 0;
    line-height: 1.1;
    /* letter-spacing: 6px; REMOVED: Breaks Arabic text in export */
    /* text-transform: uppercase; REMOVED per user request */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.genre-label {
    font-size: var(--canvas-genre-size);
    /* Relative size */
    color: var(--accent-yellow);
    margin-top: 1.5cqw;
    /* letter-spacing: 1px; REMOVED: Breaks Arabic text */
    opacity: 1;
}

/* HORIZONTAL TWEAKS: Smaller Genre, closer to title */
.horizontal .genre-label {
    font-size: calc(var(--canvas-genre-size) * 0.7) !important;
    margin-top: 5px !important;
    /* Tighter spacing */
}

.synopsis-wrapper {
    margin-top: 2cqw;
    flex: 1;
    overflow: hidden;
    /* Strict clipping for html2canvas */
}

.horizontal .synopsis-wrapper {
    /* Allow full height based on flex availability */
    max-height: none !important;
    overflow: hidden;
}

.horizontal #synopsis-text {
    -webkit-line-clamp: 8 !important;
    max-height: none !important;
}

#synopsis-text {
    width: 100%;
    min-height: 100%;
    background: transparent;
    border: none;
    color: #eee;
    font-family: var(--font-ar);
    font-size: var(--canvas-synopsis-size);
    /* Relative size */
    line-height: 1.5;
    outline: none;
    direction: rtl;
    text-align: right;
    unicode-bidi: embed;
    padding: 1cqw 0;
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 4;
    line-clamp: 4;
    -webkit-box-orient: vertical;
}

#synopsis-text:focus {
    outline: none;
}

/* Dynamic Synopsis Scaling - Based on Icon Count */
#synopsis-text.scale-medium {
    font-size: calc(var(--canvas-synopsis-size) * 0.85) !important;
}

#synopsis-text.scale-heavy {
    font-size: calc(var(--canvas-synopsis-size) * 0.75) !important;
}

#synopsis-text.scale-extreme {
    font-size: calc(var(--canvas-synopsis-size) * 0.65) !important;
    display: -webkit-box !important;
    -webkit-line-clamp: 3 !important;
    -webkit-box-orient: vertical !important;
    overflow: hidden !important;
}

/* Placeholder for contenteditable div */
[contenteditable]:empty:before {
    content: attr(placeholder);
    color: #888;
    pointer-events: none;
    display: block;
}

/* VERTICAL LAYOUT */
.vertical .canvas-content {
    flex-direction: column;
    align-items: center;
    padding: 3cqw;
    justify-content: center;
    /* Center everything vertically */
    gap: 2cqw;
    /* Gap between Header, Poster, Icons */
    transition: justify-content 0.3s ease;
}

/* Dynamic Space Optimization (1 Row of Icons) */
.vertical .canvas-content.single-row {
    justify-content: space-between;
    /* Push Title Top, Icons Bottom */
    padding-top: 4cqw;
    padding-bottom: 4cqw;
}

.vertical .canvas-content.single-row .poster-container {
    max-height: 65%;
    /* Bigger poster when space permits */
    width: 65%;
    /* Slightly wider too */
}

.vertical .poster-container {
    position: relative;
    width: 55%;
    height: auto;
    max-height: 55%;
    z-index: 5;
    border: 3px solid rgba(255, 255, 255, 0.3);
    overflow: hidden;
    margin: 0 auto;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
    order: 2;
}

.vertical #poster-img {
    /* poster-div handles width/height/fit */
    opacity: 1;
    filter: none;
}

/* Removed gradient overlay - not needed with centered poster design */

/* FULL BLUR BACKGROUND */
.vertical .canvas-bg {
    height: 100%;
    width: 100%;
    z-index: 1;
    pointer-events: none;
}

.vertical .info-content-right {
    display: contents;
    /* Allows children to be ordered with siblings */
    pointer-events: none;
}

.vertical .info-content-right>* {
    pointer-events: auto;
}

/* Show title at top in vertical mode */
.vertical .header-info {
    display: flex !important;
    flex-direction: column;
    position: relative;
    width: 100%;
    text-align: center;
    z-index: 10;
    order: 1;
    margin-bottom: 0;
    /* Let main gap handle spacing */
}

.vertical .header-info h2 {
    -webkit-line-clamp: unset !important;
    line-clamp: unset !important;
    overflow: visible !important;
    font-size: calc(var(--canvas-v-title-size) * 1.3);
    /* Made bigger as requested */
    /* Consistently large */
    text-shadow: 0.5cqw 0.5cqw 2cqw rgba(0, 0, 0, 1);
    transition: font-size 0.2s ease;
}

/* Dynamic resizing for long titles */
.vertical .header-info h2[data-length="medium"] {
    font-size: calc(var(--canvas-v-title-size) * 1.1);
}

.vertical .header-info h2[data-length="long"] {
    font-size: calc(var(--canvas-v-title-size) * 0.9);
}

.vertical .header-info h2[data-length="xl"] {
    font-size: calc(var(--canvas-v-title-size) * 0.7);
}

.vertical .genre-label {
    display: none !important;
}

.vertical .synopsis-wrapper {
    display: none !important;
}

/* STICKERS GRID */
.stickers-grid-canvas {
    display: grid;
    gap: 0.8cqw;
    /* Reduced from 1.5cqw */
    margin-top: auto;
    padding: 1cqw;
    /* Reduced padding too */
    /* Added 10px padding from all sides */
}

.horizontal .stickers-grid-canvas {
    grid-template-columns: repeat(5, 1fr);
    width: fit-content;
    align-self: flex-start;
}

.vertical .stickers-grid-canvas {
    grid-template-columns: repeat(5, 1fr);
    width: 100%;
    max-width: 1000px;
    padding: 1cqw;
    background: transparent;
    margin-top: 0;
    order: 3;
}

/* Logic for <= 4 icons: Center and make bigger */
.vertical .stickers-grid-canvas.few-icons {
    display: flex;
    justify-content: center;
    gap: 2cqw;
}

.vertical .stickers-grid-canvas.few-icons .sticker-item {
    width: 18%;
    /* Slightly bigger than 1/5 (20%) but with flexibility */
    max-width: 200px;
    /* Limit max size */
    flex-shrink: 0;
}

.vertical .stickers-grid-canvas.few-icons .sticker-item img {
    width: 100%;
    height: auto;
}

.sticker-item {
    aspect-ratio: 1 / 1;
    background: transparent;
    border: none;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0.8cqw;
}

.sticker-item img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.classification-label {
    /* Positioned relative to header now */
    font-size: 1.5rem;
    /* Much bigger size */
    color: rgba(255, 255, 255, 0.9);
    /* Brighter */
    margin-bottom: 12px;
    /* Increased fixed spacing */
    /* letter-spacing: 1px; Removed - breaks Arabic text in html2canvas */
    font-family: var(--font-ar);
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    /* Added slight drop shadow */
}


/* --- 4. RATINGS PANEL (Bottom Right) --- */
.ratings-panel {
    grid-column: 1 / 2;
    grid-row: 2 / 3;
    background-color: #0f0f0f;
    /* Pitch black */
    color: white;
    padding: 20px;
    display: flex;
    flex-direction: column;
    /* justify-content: space-between; */
    border: 6px solid #000;
    /* Border if needed, or blending into bg */
}

.ratings-title {
    font-size: 3rem;
    color: var(--accent-green);
    /* Green pixel text */
    text-align: center;
    margin: 0 0 20px 0;
    font-family: var(--font-ar);
    /* Pixel shadow attempt */
    text-shadow: 4px 4px 0px #003300;
}

.label-white {
    color: white;
}

.label-green {
    color: #7cb342;
    /* Requested green */
}

.ratings-grid {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.rating-row {
    display: flex;
    align-items: center;
    gap: 10px;
}

.rating-row-label {
    width: 70px;
    text-align: left;
    font-size: 1.1rem;
}

/* Bars: Red | Orange | Yellow | White */
.rating-bar-container {
    flex: 1;
    display: flex;
    height: 30px;
    border: 2px solid #000;
    position: relative;
    cursor: pointer;
}

.bar-segment {
    flex: 1;
    transition: 0.2s;
    border-left: 1px solid rgba(0, 0, 0, 0.5);
}

.bar-segment:first-child {
    border-left: none;
}

/* Inactive Colors (Dimmed) */
.seg-red {
    background: #521818;
    order: 4;
}

.seg-orange {
    background: #66380f;
    order: 3;
}

.seg-yellow {
    background: #6b5706;
    order: 2;
}

.seg-gray {
    background: #444;
    order: 1;
}

/* Active State Handling via JS classes active-1, active-2 etc */
/* If Level 1 (Red/Severe): Only Red is bright? or all up to Red? */
/* Let's assume singular highlighting based on image, but typically bars fill. */
/* Image shows: Red is left. Yellow is right. */
.rating-bar-container.active-1 .seg-red {
    background: var(--accent-red);
}

.rating-bar-container.active-2 .seg-orange {
    background: var(--accent-orange);
}

.rating-bar-container.active-3 .seg-yellow {
    background: var(--accent-yellow);
}

/* Knob */
.rating-knob {
    position: absolute;
    width: 26px;
    height: 26px;
    /* Larger circular knob */
    background: #ddd;
    border: 3px solid #333;
    border-radius: 50%;
    top: 50%;
    transform: translate(50%, -50%);
    /* Centers knob on the 'right' percentage */
    right: 12.5%;
    /* Default Gray center */
    pointer-events: none;
    transition: right 0.2s;
    box-shadow: 0 4px 0px rgba(0, 0, 0, 0.5);
}

/* Toggles */
.toggles-grid {
    margin-top: 15px;
    display: flex;
    justify-content: center;
    gap: 12px;
    flex-wrap: wrap;
}

.toggle-badge {
    background: transparent;
    padding: 10px 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    cursor: pointer;
    min-width: 140px;
    transition: all 0.1s;
}

.toggle-badge span {
    font-size: 1.1rem;
    color: #ccc;
    font-weight: bold;
}

.toggle-badge.active span {
    color: #fff;
}

.toggle-badge:active {
    transform: scale(0.98);
}

.toggle-square {
    width: 60px;
    height: 30px;
    background: #444;
    border: 4px solid #000;
    position: relative;
    flex-shrink: 0;
    box-shadow: 4px 4px 0px #000;
    transition: background 0.2s;
}

/* The Knob */
.toggle-square::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 22px;
    /* 30px height - 8px border */
    height: 22px;
    background: #888;
    border-right: 4px solid #000;
    transition: all 0.2s;
}

.toggle-badge.active .toggle-square {
    background: var(--accent-green);
}

.toggle-badge.active .toggle-square::after {
    left: 30px;
    background: #fff;
    border-right: none;
    border-left: 4px solid #000;
}

.warning-text {
    margin-top: auto;
    font-size: 1.4rem;
    /* Increased size (+5px approx) */
    color: #fff;
    /* White body text */
    text-align: center;
    /* Centered as requested */
    padding-top: 10px;
    font-family: var(--font-ar);
}

.warn-prefix {
    color: var(--accent-yellow);
    font-weight: bold;
}

.warning-text a {
    color: #3498db;
    /* Blue link */
    text-decoration: none;
}

.warning-text a:hover {
    text-decoration: underline;
}

/* --- 5. FOOTER (Export) --- */
.card-footer {
    grid-column: 1 / 3;
    grid-row: 3 / 4;
    display: flex;
    justify-content: center;
    margin-top: -10px;
    /* Pull up closer */
}

#export-btn {
    background: #2980b9;
    color: white;
    font-family: var(--font-ar);
    font-size: 1.5rem;
    padding: 10px 50px;
    border-radius: 30px;
    border: 4px solid #fff;
    cursor: pointer;
    box-shadow: 0 5px 0 #1c5980;
}

#export-btn:active {
    transform: translateY(5px);
    box-shadow: none;
}

.hidden {
    display: none !important;
}

/* --- MODAL STYLES --- */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.85);
    z-index: 1000;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    backdrop-filter: blur(5px);
}

.modal-content {
    background-color: #222;
    /* Darker background */
    border: 6px solid #000;
    width: 100%;
    max-width: 80vw;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    box-shadow: 20px 20px 0px rgba(0, 0, 0, 0.5);
    animation: modalSlide 0.3s ease-out;
    color: #eee;
    /* Light text default */
}

/* ... existing keyframes ... */

/* Header styles remain fine (already dark) */

.section-title {
    font-size: 2rem;
    color: #fff;
    /* White title */
    border-bottom: 4px solid #fff;
    /* White underline */
    margin-bottom: 20px;
    padding-bottom: 5px;
    display: inline-block;
}

/* Grid styles ... */

.modal-item {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    background: rgba(255, 255, 255, 0.05);
    /* Light transparency */
    padding: 15px;
    border: 3px solid #000;
}

/* Image styles ... */

.item-text strong {
    display: block;
    font-size: 1.5rem;
    color: #fff;
    /* White strong text */
    margin-bottom: 5px;
}

.item-text p {
    margin: 0;
    font-size: 1.2rem;
    line-height: 1.4;
    color: #ccc;
    /* Light gray paragraph */
}

/* Level info styles ... */

.comparison-table {
    display: flex;
    flex-direction: column;
    border: 4px solid #000;
    margin-top: 20px;
    background: #333;
    /* Dark table bg */
}

.desc-cell {
    padding: 10px;
    font-size: 0.95rem;
    line-height: 1.4;
    border-left: 2px solid #000;
    background: #2a2a2a;
    /* Dark cell bg */
    color: #eee;
    /* Light cell text */
}

@keyframes modalSlide {
    from {
        transform: translateY(20px);
        opacity: 0;
    }

    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.modal-header {
    background: #111;
    color: white;
    padding: 15px 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 6px solid #000;
}

.modal-header h2 {
    margin: 0;
    font-size: 1.8rem;
    font-family: var(--font-ar);
}

.close-btn {
    background: var(--accent-red);
    color: white;
    border: 3px solid #000;
    font-size: 2rem;
    width: 40px;
    height: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    font-family: var(--font-en);
    box-shadow: 4px 4px 0px #000;
}

.close-btn:active {
    transform: translate(2px, 2px);
    box-shadow: 2px 2px 0px #000;
}

.modal-body {
    padding: 25px;
    overflow: visible;
    flex: 1;
}



/* Restored Layout Rules */
.modal-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
}

.modal-grid.small-grid {
    grid-template-columns: repeat(3, 1fr);
}

.modal-grid.small-grid .modal-item img {
    background: transparent;
    border: none;
}

.modal-item img {
    width: 100px;
    height: 100px;
    object-fit: contain;
    flex-shrink: 0;
    /* Background & Border handled in .modal-item rule above */
    background: #000;
    padding: 8px;
    border: none;
}

.levels-info {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
}

.level-box {
    flex: 1;
    padding: 10px;
    text-align: center;
    font-weight: bold;
    border: 3px solid #000;
    box-shadow: 4px 4px 0px #000;
}

.level-box.yellow {
    background: var(--accent-yellow);
    color: #000;
}

.level-box.orange {
    background: var(--accent-orange);
    color: #fff;
}

.level-box.red {
    background: var(--accent-red);
    color: #fff;
}

.comparison-table {
    display: flex;
    flex-direction: column;
    border: 4px solid #000;
    margin-top: 20px;
}

.table-header {
    display: grid;
    grid-template-columns: 80px 1fr 1fr;
    background: #111;
    color: white;
    font-weight: bold;
}

.table-header div {
    padding: 10px;
    border-left: 2px solid #333;
}

.table-row {
    display: grid;
    grid-template-columns: 80px 1fr 1fr;
    border-bottom: 2px solid #000;
}

.table-row:last-child {
    border-bottom: none;
}

.level-cell {
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.5rem;
    font-weight: bold;
    border-left: 2px solid #000;
}

.level-cell.yellow {
    background: var(--accent-yellow);
    color: #000;
}

.level-cell.orange {
    background: var(--accent-orange);
    color: #fff;
}

.level-cell.red {
    background: var(--accent-red);
    color: #fff;
}



.desc-cell:last-child {
    border-left: none;
}

/* Responsive fixes for modal */
@media (max-width: 768px) {
    .modal-grid {
        grid-template-columns: 1fr;
    }

    .table-header,
    .table-row {
        grid-template-columns: 50px 1fr 1fr;
    }

    .levels-info {
        flex-direction: column;
    }

    @media (max-width: 900px) {
        body {
            padding: 10px;
            align-items: flex-start;
            height: auto;
        }

        .card-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 100%;
            gap: 15px;
            padding: 15px;
            border-width: 4px;
        }

        /* 1. Header */
        .card-header {
            order: 1;
            grid-column: auto;
            grid-row: auto;
            padding: 15px;
            border-width: 4px;
        }

        .logo {
            font-size: 3rem;
        }

        .subtitle-ar {
            font-size: 1rem;
        }

        /* 2. Controls & Ratings */
        .top-controls {
            order: 2;
            grid-column: auto;
            grid-row: auto;
            max-height: none;
            overflow: visible;
            padding: 15px;
            border-width: 4px;
            flex: 1 0 auto;
        }

        /* Stack controls */
        .control-row {
            flex-direction: column;
            align-items: stretch;
            gap: 5px;
            margin-bottom: 15px;
        }

        .control-label {
            text-align: right;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .orientation-selector,
        .custom-dropdown,
        .search-wrapper {
            width: 100%;
            display: flex;
            box-sizing: border-box;
        }

        .orient-btn {
            flex: 1;
        }

        .dropdown-toggle {
            width: 100%;
            justify-content: space-between;
        }

        /* Search Fixes */
        .search-wrapper {
            width: 100%;
        }

        /* Ratings */
        .ratings-section {
            margin-top: 20px;
        }

        .ratings-title {
            font-size: 2rem;
        }

        .rating-row {
            gap: 5px;
        }

        .rating-row-label {
            font-size: 0.9rem;
            width: 50px;
        }

        .rating-bar-container {
            height: 25px;
        }

        /* 3. Preview Canvas */
        .info-panel {
            order: 3;
            grid-column: auto;
            grid-row: auto;
            width: 100%;
            border-width: 4px;
            min-height: 300px;
        }

        /* Fix Vertical Panel fixed height */
        .info-panel.vertical {
            height: auto;
            aspect-ratio: 2/3;
            max-height: none;
            margin: 0;
        }

        /* 4. Footer */
        .card-footer {
            order: 4;
            grid-column: auto;
            grid-row: auto;
            margin-top: 10px;
            padding-bottom: 20px;
        }

        #export-btn {
            width: 100%;
            font-size: 1.2rem;
            padding: 10px;
        }

        /* Modal adjustments */
        .modal-content {
            max-width: 95vw;
            max-height: 90vh;
            border-width: 3px;
            margin: 10px;
        }
    }
}

/* Tablet/Constrained Desktop Tweaks */
@media (max-width: 1200px) {
    .rating-row {
        flex-direction: column;
        align-items: stretch;
        margin-bottom: 5px;
    }

    .rating-row-label {
        width: 100%;
        text-align: right;
        font-size: 1rem;
        margin-bottom: 2px;
    }

    .rating-bar-container {
        width: 100%;
        height: 30px;
    }
}

/* Export Mode Overrides */
.export-mode {
    --canvas-title-size: 106px;
    --canvas-genre-size: 54px;
    --canvas-synopsis-size: 40px;
    --canvas-v-title-size: 114px;
    /* Reduced to 114px */
    width: 1920px !important;
    min-width: 1920px !important;
    max-width: none !important;
}

/* Fix Vertical Export Poster: "Contain" to always show full image without cropping */
.export-mode.vertical .poster-div {
    background-size: contain !important;
    background-repeat: no-repeat !important;
    background-position: center bottom !important;
    background-position: center bottom !important;
}

.export-mode.vertical .poster-container {
    max-height: none !important;
    /* Allow it to grow/shrink freely */
    width: auto !important;
    /* Let aspect ratio drive width */
    flex: 1 1 auto !important;
    /* Flexibly fill available vertical space */
    aspect-ratio: var(--poster-aspect-ratio, 2/3) !important;
    /* Adapt to image shape */
}

.export-mode #synopsis-text {
    line-height: 1.3 !important;
}

.export-mode.vertical {
    width: 1200px !important;
    min-width: 1200px !important;
    max-width: none !important;
    height: 1800px !important;
    aspect-ratio: 2 / 3 !important;
}

/* FIX SEARCH OVERFLOW */
#search-results {
    position: absolute !important;
    top: 100% !important;
    left: auto !important;
    right: 0 !important;
    width: 100% !important;
    max-width: 100% !important;
    overflow-x: hidden !important;
    overflow-y: auto !important;
    box-sizing: border-box !important;
    max-height: 250px !important;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5) !important;
    border-radius: 0 0 10px 10px !important;
    z-index: 99999 !important;
    background-color: #222 !important;
}

.search-result-item {
    overflow: hidden !important;
}

.search-result-item span {
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    min-width: 0 !important;
    flex: 1 !important;
}

/* WATERMARK STYLING - REFINED & LIGATURE FRIENDLY */
#watermark-display {
    margin-top: auto;
    font-family: var(--font-ar);
    /* Use Arabic Pixel Font */
    color: #ffffff;
    border: 3px dashed #ffffff;
    padding: 5px 25px;
    font-size: 2cqw;
    text-shadow: none;
    box-shadow: 0 0 8px #ffffff;
    align-self: center;
    direction: rtl;
    opacity: 1;
    background: transparent;
    font-weight: bold;
    letter-spacing: normal !important;
    /* CRITICAL: Fixed disconnected Arabic letters */
}

.vertical #watermark-display {
    font-size: 3cqw;
    order: 10;
    margin-top: 4cqw;
    /* Lowered from 2cqw */
}

#watermark-display.hidden {
    display: none !important;
}

/* HORIZONTAL VIEW - MATCH EXPORT POSITION */
.horizontal #watermark-display {
    padding: 5px 20px !important;
    margin-top: 10px !important;
    /* Match export top gap */
}

/* EXPORT MODE - MATCH SCREEN STYLE SAFER */
.export-mode #watermark-display {
    box-shadow: none !important;
    /* Disabled to fix white block */
    text-shadow: none !important;
    background-color: rgba(0, 0, 0, 0.6) !important;
    border: 4px dashed #ffffff !important;
    opacity: 1 !important;
    padding: 5px 20px !important;
    /* Tiny */
    font-size: 18px !important;
    /* Tiny */
    letter-spacing: normal !important;
    margin-bottom: -30px !important;
    /* 30px gap */
    margin-top: 10px !important;
}

/* FIX: Restored padding for poster */

.export-mode.vertical #watermark-display {
    font-size: 24px !important;
    padding: 8px 25px !important;
    margin-bottom: -30px !important;
}

/* RESPONSIVE HIGH-QUALITY VERTICAL PREVIEW */
/* Trigger "Export Style" layout when screen is vertical (Mobile/Portrait) */
@media (orientation: portrait),
(max-width: 600px) {

    /* Unlock the container to fill space dynamically */
    .vertical .poster-container {
        max-height: none !important;
        width: auto !important;
        flex: 1 1 auto;
        /* Use the JS-calculated aspect ratio, fallback to 2/3 */
        aspect-ratio: var(--poster-aspect-ratio, 2/3);
        min-height: 0;
    }

    /* Force full image visibility (Contain) instead of cropping (Cover) */
    .vertical .poster-div {
        background-size: contain !important;
        background-repeat: no-repeat !important;
        background-position: center bottom !important;
    }
}